___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Mediajel - Ecommerce Attribution",
  "categories": ["AFFILIATE_MARKETING", "ADVERTISING", ATTRIBUTION],
  "brand": {
    "id": "brand_dummy",
    "displayName": "",
    "thumbnail": "data:image/png;base64,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\u003d"
  },
  "description": "Custom template to install universal tag in your website",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "appId",
    "displayName": "App ID",
    "simpleValueType": true,
    "help": "Input the App ID for the collector. This will trigger a pageview event.",
    "valueValidators": [
      {
        "type": "NON_EMPTY",
        "errorMessage": "App ID is required"
      },
      {
        "type": "REGEX",
        "args": [
          "^[A-Z0-9][a-z0-9]+(?:[A-Z0-9][a-z0-9]+)*$"
        ],
        "errorMessage": "Must be a Pascal case i.e AppId"
      }
    ],
    "valueHint": "AppId"
  },
  {
    "type": "TEXT",
    "name": "retailId",
    "displayName": "Retail ID",
    "simpleValueType": true,
    "help": "Append the Retail ID of the ecommerce site. It is imperative that the Retail ID is persistent from initial visit up until cart checkout."
  },
  {
    "type": "SELECT",
    "name": "environment",
    "displayName": "Environment",
    "selectItems": [
      {
        "value": "jane",
        "displayValue": "Jane"
      },
      {
        "value": "dutchie-subdomain",
        "displayValue": "Dutchie Subdomain"
      },
      {
        "value": "dutchie-iframe",
        "displayValue": "Dutchie Iframe"
      },
      {
        "value": "meadow",
        "displayValue": "Meadow"
      },
      {
        "value": "tymber",
        "displayValue": "Tymber"
      },
      {
        "value": "woocommerce",
        "displayValue": "Woocommerce"
      },
      {
        "value": "greenrush",
        "displayValue": "Greenrush"
      },
      {
        "value": "buddi",
        "displayValue": "Buddi"
      },
      {
        "value": "shopify",
        "displayValue": "Shopify"
      },
      {
        "value": "lightspeed",
        "displayValue": "Lightspeed"
      },
      {
        "value": "olla",
        "displayValue": "Olla"
      },
      {
        "value": "",
        "displayValue": "Others"
      }
    ],
    "simpleValueType": true,
    "help": "Select the cart environment for the collector on this argument. This will trigger ecommerce tracking for the specific environment. Select others if none of your cart is in the list."
  },
  {
    "type": "RADIO",
    "name": "version",
    "displayName": "Version",
    "radioItems": [
      {
        "value": 1,
        "displayValue": "Version 1"
      },
      {
        "value": 2,
        "displayValue": "Version 2"
      }
    ],
    "simpleValueType": true,
    "defaultValue": 1,
    "help": "Choose a version of your choice."
  },
  {
    "type": "TEXT",
    "name": "otherParams",
    "displayName": "Other Parameters",
    "simpleValueType": true,
    "help": "Optionally add parameters",
    "valueHint": "\u0026params\u003dparams"
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

// Require the necessary APIs
const logToConsole = require('logToConsole');
const injectScript = require('injectScript');
const queryPermission = require('queryPermission');

const appId = data.appId;
const retailId = data.retailId ? '&retailId='+data.retailId : '';
const environment = data.environment ? '&environment='+data.environment:'';
const version = data.version ? '&version='+data.version : '';
const otherParams = data.otherParams;
const url = 'https://tags.cnna.io/?'+'appId='+appId+retailId+environment+version+otherParams;

const log = logToConsole;

log('Loading script from ' + url);

// If the script loaded successfully, log a message and signal success
const onSuccess = () => {
  log('Script loaded successfully.');
  data.gtmOnSuccess();
};

// If the script fails to load, log a message and signal failure
const onFailure = () => {
  log('Script load failed.');
  data.gtmOnFailure();
};

// If the URL input by the user matches the permissions set for the template,
// inject the script with the onSuccess and onFailure methods as callbacks.
if (queryPermission('inject_script', url)) {
  injectScript(url, onSuccess, onFailure);
} else {
  log('Script load failed due to permissions mismatch.');
  data.gtmOnFailure();
}


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://*.tags.cnna.io/"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Created on 6/7/2022, 10:30:13 PM


